<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>StellarBay — API Platform</title>

  <!-- Tailwind Play CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          animation: {
            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
            'bounce-slow': 'bounce 2s infinite',
          }
        }
      }
    }
  </script>

  <!-- Optional: Prism for code highlighting -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup.min.js"></script>

  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    /* Custom animations */
    @keyframes slideIn {
      from { transform: translateY(8px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .anim-slide-in { animation: slideIn .28s ease both; }

    /* response box monospace */
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace; }

    /* code preview sizing */
    pre.prism { max-height: 380px; overflow:auto; border-radius: 0.5rem; padding: 1rem; }

    /* small scrollbar style */
    ::-webkit-scrollbar { height: 8px; width: 8px; }
    ::-webkit-scrollbar-thumb { background: rgba(100,100,100,0.25); border-radius:8px; }

    /* Custom gradient backgrounds */
    .gradient-bg {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #d946ef 100%);
    }
    
    /* Glassmorphism effect */
    .glass {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    /* API status indicators */
    .status-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 6px;
    }
    .status-active {
      background-color: #10b981;
    }
    .status-inactive {
      background-color: #ef4444;
    }

    /* Loading states */
    .loading {
      opacity: 0.6;
      pointer-events: none;
    }
  </style>
</head>
<body class="bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-100 antialiased transition-colors duration-300">

  <!-- Root container -->
  <div class="min-h-screen flex">

    <!-- Sidebar -->
    <aside id="sidebar" class="w-72 bg-white dark:bg-slate-800 shadow-lg border-r border-slate-200 dark:border-slate-700 transition-all duration-300 transform z-10">
      <div class="px-6 py-5 flex items-center gap-3">
        <div class="p-2 gradient-bg rounded-xl shadow text-white">
          <i class="fas fa-code text-lg"></i>
        </div>
        <div>
          <div class="font-bold text-lg">StellarBay</div>
          <div class="text-xs text-slate-500 dark:text-slate-400">API Platform</div>
        </div>
      </div>

      <nav class="px-4 mt-6">
        <button data-tab="dashboard" class="tab-btn w-full flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700">
          <i class="fas fa-tachometer-alt text-slate-500 w-5 text-center"></i>
          <span>Dashboard</span>
        </button>

        <button data-tab="api-endpoints" class="tab-btn w-full flex items-center gap-3 px-3 py-2 mt-1 rounded-lg bg-indigo-50 dark:bg-indigo-900/20">
          <i class="fas fa-server text-indigo-600 w-5 text-center"></i>
          <span>API Endpoints</span>
        </button>

        <button data-tab="api-playground" class="tab-btn w-full flex items-center gap-3 px-3 py-2 mt-1 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700">
          <i class="fas fa-flask text-sky-500 w-5 text-center"></i>
          <span>API Playground</span>
        </button>

        <button data-tab="documentation" class="tab-btn w-full flex items-center gap-3 px-3 py-2 mt-1 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700">
          <i class="fas fa-book text-emerald-500 w-5 text-center"></i>
          <span>Documentation</span>
        </button>
      </nav>

      <div class="mt-auto px-6 py-4">
        <div class="flex items-center justify-between">
          <div class="text-sm text-slate-500 dark:text-slate-400">Dark Mode</div>
          <button id="themeToggle" class="p-2 bg-slate-100 dark:bg-slate-700 rounded-full transition-colors">
            <i id="themeIcon" class="fas fa-moon text-yellow-400"></i>
          </button>
        </div>
        <div class="mt-3 text-xs text-slate-400">Status: <span id="apiStatus" class="font-medium"><i class="fas fa-circle text-green-500 mr-1"></i>Connected</span></div>
      </div>
    </aside>

    <!-- Main -->
    <main class="flex-1 p-8 overflow-y-auto transition-all duration-300">
      <!-- Top bar -->
      <header class="flex items-center justify-between gap-4 mb-6">
        <div class="flex items-center gap-4">
          <button id="sidebarToggle" class="p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700">
            <i class="fas fa-bars text-slate-600 dark:text-slate-200"></i>
          </button>
          <div>
            <h1 class="text-2xl font-bold">API Platform</h1>
            <p class="text-sm text-slate-500 dark:text-slate-400">Manage your Django API endpoints and monitor performance.</p>
          </div>
        </div>

        <div class="flex items-center gap-3">
          <div class="hidden md:flex items-center gap-3 bg-white dark:bg-slate-800 border border-slate-100 dark:border-slate-700 rounded-xl px-3 py-1">
            <i class="fas fa-search text-slate-400"></i>
            <input id="globalSearch" placeholder="Search endpoints, docs..." class="bg-transparent outline-none text-sm w-64" />
          </div>

          <button id="newEndpointBtn" class="px-3 py-2 bg-indigo-600 text-white rounded-lg hover:shadow-lg transition-all">
            <i class="fas fa-plus mr-2"></i>New Endpoint
          </button>
        </div>
      </header>

      <!-- Content panes -->
      <section id="contentArea">
        <!-- Dashboard -->
        <div data-pane="dashboard" class="pane anim-slide-in">
          <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
            <div class="rounded-2xl bg-white dark:bg-slate-800 p-6 shadow">
              <div class="flex items-center justify-between">
                <div>
                  <div class="text-xs text-slate-500">Active Endpoints</div>
                  <div id="totalEndpoints" class="font-bold text-2xl">-</div>
                </div>
                <div class="p-3 rounded-full bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600">
                  <i class="fas fa-server"></i>
                </div>
              </div>
              <div class="mt-2 text-xs text-slate-500">
                <span id="endpointsTrend" class="text-green-500"><i class="fas fa-arrow-up"></i> Loading...</span>
              </div>
            </div>

            <div class="rounded-2xl bg-white dark:bg-slate-800 p-6 shadow">
              <div class="flex items-center justify-between">
                <div>
                  <div class="text-xs text-slate-500">API Requests</div>
                  <div id="reqCount" class="font-bold text-2xl">-</div>
                </div>
                <div class="p-3 rounded-full bg-green-100 dark:bg-green-900/30 text-green-600">
                  <i class="fas fa-chart-line"></i>
                </div>
              </div>
              <div class="mt-2 text-xs text-slate-500">
                <span id="requestsTrend" class="text-green-500"><i class="fas fa-arrow-up"></i> Loading...</span>
              </div>
            </div>

            <div class="rounded-2xl bg-white dark:bg-slate-800 p-6 shadow">
              <div class="flex items-center justify-between">
                <div>
                  <div class="text-xs text-slate-500">Success Rate</div>
                  <div id="successRate" class="font-bold text-2xl">-</div>
                </div>
                <div class="p-3 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-600">
                  <i class="fas fa-check-circle"></i>
                </div>
              </div>
              <div class="mt-2 text-xs text-slate-500">
                <span id="successTrend" class="text-green-500"><i class="fas fa-arrow-up"></i> Loading...</span>
              </div>
            </div>

            <div class="rounded-2xl bg-white dark:bg-slate-800 p-6 shadow">
              <div class="flex items-center justify-between">
                <div>
                  <div class="text-xs text-slate-500">Avg Response Time</div>
                  <div id="avgResponseTime" class="font-bold text-2xl">-</div>
                </div>
                <div class="p-3 rounded-full bg-purple-100 dark:bg-purple-900/30 text-purple-600">
                  <i class="fas fa-tachometer-alt"></i>
                </div>
              </div>
              <div class="mt-2 text-xs text-slate-500">
                <span id="responseTrend" class="text-green-500"><i class="fas fa-arrow-down"></i> Loading...</span>
              </div>
            </div>
          </div>

          <div class="grid md:grid-cols-2 gap-6">
            <div class="rounded-2xl bg-white dark:bg-slate-800 p-6 shadow">
              <h2 class="font-semibold text-lg mb-4">Recent Activity</h2>
              <div id="recentActivity" class="space-y-4">
                <div class="flex items-center justify-center py-8">
                  <i class="fas fa-spinner fa-spin text-slate-400 mr-2"></i>
                  <span class="text-slate-500">Loading recent activity...</span>
                </div>
              </div>
            </div>

            <div class="rounded-2xl bg-white dark:bg-slate-800 p-6 shadow">
              <h2 class="font-semibold text-lg mb-4">Quick Actions</h2>
              <div class="grid grid-cols-2 gap-4">
                <button id="quickAddEndpoint" class="p-4 rounded-lg bg-indigo-50 dark:bg-indigo-900/20 hover:bg-indigo-100 dark:hover:bg-indigo-900/30 transition-colors text-left">
                  <i class="fas fa-plus text-indigo-600 mb-2"></i>
                  <div class="font-medium">Add Endpoint</div>
                  <div class="text-xs text-slate-500 mt-1">Create a new API endpoint</div>
                </button>
                <button id="quickTestAll" class="p-4 rounded-lg bg-sky-50 dark:bg-sky-900/20 hover:bg-sky-100 dark:hover:bg-sky-900/30 transition-colors text-left">
                  <i class="fas fa-flask text-sky-600 mb-2"></i>
                  <div class="font-medium">Test All APIs</div>
                  <div class="text-xs text-slate-500 mt-1">Run tests on all endpoints</div>
                </button>
                <button id="quickGenerateDocs" class="p-4 rounded-lg bg-emerald-50 dark:bg-emerald-900/20 hover:bg-emerald-100 dark:hover:bg-emerald-900/30 transition-colors text-left">
                  <i class="fas fa-book text-emerald-600 mb-2"></i>
                  <div class="font-medium">Generate Docs</div>
                  <div class="text-xs text-slate-500 mt-1">Create API documentation</div>
                </button>
                <button id="quickExportConfig" class="p-4 rounded-lg bg-amber-50 dark:bg-amber-900/20 hover:bg-amber-100 dark:hover:bg-amber-900/30 transition-colors text-left">
                  <i class="fas fa-cog text-amber-600 mb-2"></i>
                  <div class="font-medium">Export Config</div>
                  <div class="text-xs text-slate-500 mt-1">Export API configuration</div>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- API Endpoints -->
        <div data-pane="api-endpoints" class="pane hidden anim-slide-in">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h2 class="font-semibold text-xl">API Endpoints</h2>
              <p class="text-sm text-slate-500">Manage your Django REST API endpoints</p>
            </div>
            <div class="flex items-center gap-3">
              <select id="statusFilter" class="px-3 py-2 rounded-lg bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700">
                <option value="all">All Status</option>
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
              </select>
              <button id="refreshEndpoints" class="px-3 py-2 rounded-lg bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700">
                <i class="fas fa-sync-alt mr-2"></i>Refresh
              </button>
            </div>
          </div>

          <!-- Endpoints Grid -->
          <div id="endpointsGrid" class="grid gap-4">
            <div class="flex items-center justify-center py-12">
              <div class="text-center">
                <i class="fas fa-spinner fa-spin text-slate-400 text-2xl mb-2"></i>
                <p class="text-slate-500">Loading endpoints...</p>
              </div>
            </div>
          </div>
        </div>

        <!-- API Playground -->
        <div data-pane="api-playground" class="pane hidden anim-slide-in">
          <div class="grid lg:grid-cols-2 gap-6">
            <div class="rounded-2xl bg-white dark:bg-slate-800 p-6 shadow">
              <h2 class="font-semibold text-lg mb-4">API Playground</h2>
              <p class="text-sm text-slate-500 dark:text-slate-400 mb-4">Test endpoints with method, headers & payload. Response will show formatted JSON or text.</p>

              <div class="space-y-4">
                <div class="flex gap-2">
                  <select id="httpMethod" class="px-3 py-2 rounded-lg border dark:bg-slate-700 dark:border-slate-600">
                    <option>GET</option>
                    <option>POST</option>
                    <option>PUT</option>
                    <option>PATCH</option>
                    <option>DELETE</option>
                  </select>
                  <input id="apiUrl" placeholder="https://api.example.com/users" class="flex-1 px-3 py-2 rounded-lg border dark:bg-slate-700 dark:border-slate-600" />
                </div>

                <div>
                  <label class="text-xs text-slate-500">Headers (JSON)</label>
                  <textarea id="apiHeaders" rows="3" class="w-full mt-1 px-3 py-2 rounded-lg border dark:bg-slate-700 dark:border-slate-600 mono" placeholder='{"Content-Type":"application/json"}'></textarea>
                </div>

                <div>
                  <label class="text-xs text-slate-500">Body (JSON) — optional</label>
                  <textarea id="apiBody" rows="5" class="w-full mt-1 px-3 py-2 rounded-lg border dark:bg-slate-700 dark:border-slate-600 mono" placeholder='{"name":"John"}'></textarea>
                </div>

                <div class="flex items-center gap-2">
                  <button id="sendReq" class="px-4 py-2 bg-sky-600 text-white rounded-lg hover:bg-sky-700 transition-colors">
                    <i class="fas fa-paper-plane mr-2"></i>Send Request
                  </button>
                  <button id="clearResp" class="px-4 py-2 bg-slate-100 dark:bg-slate-700 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors">
                    <i class="fas fa-broom mr-2"></i>Clear
                  </button>
                  <div class="text-sm text-slate-500 ml-auto">Timeout: <span id="timeoutLabel">10s</span></div>
                </div>
              </div>
            </div>

            <div class="rounded-2xl bg-white dark:bg-slate-800 p-6 shadow flex flex-col">
              <div class="flex items-center justify-between">
                <h3 class="font-semibold">Response</h3>
                <div class="text-xs text-slate-400">Status: <span id="respStatus">—</span></div>
              </div>

              <div id="respBox" class="mt-4 p-3 border rounded-lg bg-slate-50 dark:bg-slate-900 overflow-auto flex-1">
                <pre id="respContent" class="mono text-sm whitespace-pre-wrap">No request yet — try sending one.</pre>
              </div>

              <div class="mt-3 flex items-center gap-2">
                <button id="copyResp" class="px-3 py-1 rounded bg-indigo-600 text-white hover:bg-indigo-700 transition-colors">
                  <i class="fas fa-copy mr-1"></i>Copy Response
                </button>
                <button id="saveCurl" class="px-3 py-1 rounded border hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors">
                  <i class="fas fa-terminal mr-1"></i>Copy cURL
                </button>
                <div class="text-sm text-slate-400 ml-auto">Requests: <span id="sentCount">0</span></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Documentation -->
        <div data-pane="documentation" class="pane hidden anim-slide-in">
          <div class="rounded-2xl bg-white dark:bg-slate-800 p-6 shadow">
            <h2 class="font-semibold text-lg mb-4">API Documentation</h2>
            <p class="text-sm text-slate-500 mb-6">Comprehensive guide to using the StellarBay API platform.</p>

            <div class="grid md:grid-cols-2 gap-6">
              <div>
                <h4 class="font-medium mb-3">Getting Started</h4>
                <ol class="text-sm text-slate-500 list-decimal ml-5 space-y-2">
                  <li>Set up your Django REST API with proper CORS headers</li>
                  <li>Add your API base URL in the settings</li>
                  <li>Create endpoints following REST conventions</li>
                  <li>Test endpoints using the API Playground</li>
                  <li>Monitor performance through the Dashboard</li>
                </ol>
              </div>

              <div>
                <h4 class="font-medium mb-3">Available Endpoints</h4>
                <div class="bg-slate-50 dark:bg-slate-900 rounded-lg p-4">
                  <div class="grid grid-cols-12 gap-2 text-xs font-medium text-slate-500 mb-2">
                    <div class="col-span-2">Method</div>
                    <div class="col-span-6">Endpoint</div>
                    <div class="col-span-4">Description</div>
                  </div>
                  <div id="apiEndpointsList" class="space-y-2">
                    <!-- Dynamic endpoints will be loaded here -->
                  </div>
                </div>
              </div>
            </div>

            <div class="mt-6">
              <h4 class="font-medium mb-3">Authentication</h4>
              <div class="bg-slate-50 dark:bg-slate-900 rounded-lg p-4">
                <p class="text-sm text-slate-600 dark:text-slate-400 mb-3">
                  All API endpoints require JWT authentication. Include the token in the Authorization header:
                </p>
                <pre class="text-sm bg-slate-100 dark:bg-slate-800 p-3 rounded overflow-x-auto"><code>Authorization: Bearer &lt;your_jwt_token&gt;</code></pre>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Endpoint Modal -->
  <div id="endpointModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
    <div class="bg-white dark:bg-slate-800 w-full max-w-md rounded-2xl p-6 shadow-lg">
      <h3 class="font-semibold text-lg mb-4" id="modalTitle">Create New Endpoint</h3>
      <form id="endpointForm" class="space-y-4">
        <input type="hidden" id="endpointId">
        <div>
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Name</label>
          <input type="text" id="endpointName" required class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg dark:bg-slate-700">
        </div>
        <div>
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Method</label>
          <select id="endpointMethod" required class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg dark:bg-slate-700">
            <option value="GET">GET</option>
            <option value="POST">POST</option>
            <option value="PUT">PUT</option>
            <option value="PATCH">PATCH</option>
            <option value="DELETE">DELETE</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">URL</label>
          <input type="text" id="endpointUrl" required class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg dark:bg-slate-700" placeholder="/api/endpoint/">
        </div>
        <div>
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Description</label>
          <textarea id="endpointDescription" rows="3" class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg dark:bg-slate-700"></textarea>
        </div>
        <div class="flex items-center gap-2 pt-4">
          <button type="submit" class="flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">
            <i class="fas fa-save mr-2"></i>Save
          </button>
          <button type="button" id="cancelModal" class="px-4 py-2 bg-slate-100 dark:bg-slate-700 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors">
            Cancel
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Templates -->
  <template id="endpointTemplate">
    <div class="endpoint-card bg-white dark:bg-slate-800 p-4 rounded-2xl shadow border-l-4 border-indigo-500">
      <div class="flex items-start justify-between">
        <div class="flex-1">
          <div class="flex items-center gap-2 mb-2">
            <span class="method-badge px-2 py-1 rounded text-xs font-medium"></span>
            <h3 class="endpoint-title font-semibold"></h3>
            <span class="status-indicator status-active"></span>
          </div>
          <p class="endpoint-desc text-sm text-slate-500 mb-3"></p>
          <div class="endpoint-url font-mono text-xs bg-slate-100 dark:bg-slate-700 p-2 rounded"></div>
        </div>
        <div class="flex items-center gap-2 ml-4">
          <button class="endpoint-test-btn px-3 py-1 rounded text-xs bg-sky-600 text-white hover:bg-sky-700 transition-colors">
            <i class="fas fa-flask mr-1"></i>Test
          </button>
          <button class="endpoint-edit-btn px-3 py-1 rounded text-xs border hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors">
            <i class="fas fa-edit mr-1"></i>Edit
          </button>
          <button class="endpoint-delete-btn px-3 py-1 rounded text-xs bg-red-600 text-white hover:bg-red-700 transition-colors">
            <i class="fas fa-trash mr-1"></i>Delete
          </button>
        </div>
      </div>
    </div>
  </template>

  <template id="activityTemplate">
    <div class="flex items-start gap-3">
      <div class="p-2 rounded-full bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 mt-1">
        <i class="fas fa-plus text-xs"></i>
      </div>
      <div>
        <div class="font-medium activity-title"></div>
        <div class="text-sm text-slate-500 activity-details"></div>
        <div class="text-xs text-slate-400 activity-time"></div>
      </div>
    </div>
  </template>

  <!-- Scripts -->
  <script>
    // API Configuration
    const API_BASE_URL = window.location.origin;
    let authToken = localStorage.getItem('authToken');

    // API Service
    const apiService = {
      async request(url, options = {}) {
        const config = {
          headers: {
            'Content-Type': 'application/json',
            ...options.headers
          },
          ...options
        };

        if (authToken) {
          config.headers['Authorization'] = `Bearer ${authToken}`;
        }

        try {
          const response = await fetch(`${API_BASE_URL}${url}`, config);
          
          if (response.status === 401) {
            // Token expired or invalid
            localStorage.removeItem('authToken');
            window.location.reload();
            return;
          }

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          return await response.json();
        } catch (error) {
          console.error('API request failed:', error);
          showNotification('API request failed: ' + error.message, 'error');
          throw error;
        }
      },

      // Dashboard
      async getDashboardStats() {
        return await this.request('/api/dashboard/stats/');
      },

      // Endpoints
      async getEndpoints() {
        return await this.request('/api/api-endpoints/');
      },

      async createEndpoint(data) {
        return await this.request('/api/api-endpoints/', {
          method: 'POST',
          body: JSON.stringify(data)
        });
      },

      async updateEndpoint(id, data) {
        return await this.request(`/api/api-endpoints/${id}/`, {
          method: 'PUT',
          body: JSON.stringify(data)
        });
      },

      async deleteEndpoint(id) {
        return await this.request(`/api/api-endpoints/${id}/`, {
          method: 'DELETE'
        });
      },

      async toggleEndpointStatus(id) {
        return await this.request(`/api/api-endpoints/${id}/toggle_active/`, {
          method: 'POST'
        });
      },

      // API Testing
      async testEndpoint(data) {
        return await this.request('/api/proxy/test/', {
          method: 'POST',
          body: JSON.stringify(data)
        });
      },

      // Quick Actions
      async testAllEndpoints() {
        return await this.request('/api/quick-actions/', {
          method: 'POST',
          body: JSON.stringify({ action: 'test_all_endpoints' })
        });
      },

      async generateDocs() {
        return await this.request('/api/quick-actions/', {
          method: 'POST',
          body: JSON.stringify({ action: 'generate_docs' })
        });
      },

      async exportConfig() {
        return await this.request('/api/quick-actions/', {
          method: 'POST',
          body: JSON.stringify({ action: 'export_config' })
        });
      }
    };

    // Basic UI behavior
    const tabs = document.querySelectorAll('.tab-btn');
    const panes = document.querySelectorAll('.pane');
    const sidebar = document.getElementById('sidebar');
    const sidebarToggle = document.getElementById('sidebarToggle');
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');

    function showPane(id){
      panes.forEach(p => p.classList.add('hidden'));
      const target = document.querySelector(`[data-pane="${id}"]`);
      if(target) target.classList.remove('hidden');
      // highlight active tab
      tabs.forEach(t => t.classList.remove('bg-indigo-50','dark:bg-indigo-900/20'));
      const activeBtn = [...tabs].find(t => t.dataset.tab === id);
      if(activeBtn) activeBtn.classList.add('bg-indigo-50','dark:bg-indigo-900/20');
      
      // Load data when switching to specific panes
      if (id === 'dashboard') {
        loadDashboardStats();
      } else if (id === 'api-endpoints') {
        loadEndpoints();
      } else if (id === 'documentation') {
        loadDocumentation();
      }
    }

    tabs.forEach(t => t.addEventListener('click', ()=> showPane(t.dataset.tab)));
    showPane('dashboard'); // default

    // Mobile sidebar toggle
    sidebarToggle.addEventListener('click', () => {
      sidebar.classList.toggle('-translate-x-full');
    });

    // Theme toggle (persist in localStorage)
    const root = document.documentElement;
    function setTheme(dark){
      if(dark){
        root.classList.add('dark');
        themeIcon.className = 'fas fa-sun text-yellow-400';
        localStorage.setItem('devdash-dark', '1');
      } else {
        root.classList.remove('dark');
        themeIcon.className = 'fas fa-moon text-yellow-400';
        localStorage.setItem('devdash-dark', '0');
      }
    }
    
    // Check for saved theme preference or respect OS preference
    const saved = localStorage.getItem('devdash-dark');
    if (saved !== null) {
      setTheme(saved === '1');
    } else {
      // Check if user has OS dark mode preference
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      setTheme(prefersDark);
    }
    
    themeToggle.addEventListener('click', ()=> setTheme(!root.classList.contains('dark')));

    // Dashboard Functions
    async function loadDashboardStats() {
      try {
        const stats = await apiService.getDashboardStats();
        
        // Update metrics
        document.getElementById('totalEndpoints').textContent = stats.total_endpoints;
        document.getElementById('reqCount').textContent = stats.total_requests.toLocaleString();
        document.getElementById('successRate').textContent = `${stats.success_rate}%`;
        document.getElementById('avgResponseTime').textContent = `${stats.avg_response_time}ms`;
        
        // Update recent activity
        const activityContainer = document.getElementById('recentActivity');
        activityContainer.innerHTML = '';
        
        if (stats.recent_activity && stats.recent_activity.length > 0) {
          stats.recent_activity.forEach(activity => {
            const template = document.getElementById('activityTemplate').content.cloneNode(true);
            template.querySelector('.activity-title').textContent = `API Request: ${activity.endpoint_name || activity.url}`;
            template.querySelector('.activity-details').textContent = `${activity.method} - Status: ${activity.status_code}`;
            template.querySelector('.activity-time').textContent = new Date(activity.created_at).toLocaleString();
            activityContainer.appendChild(template);
          });
        } else {
          activityContainer.innerHTML = '<p class="text-slate-500 text-center py-4">No recent activity</p>';
        }
      } catch (error) {
        showNotification('Failed to load dashboard stats', 'error');
      }
    }

    // Endpoints Management
    async function loadEndpoints() {
      const grid = document.getElementById('endpointsGrid');
      grid.innerHTML = '<div class="flex items-center justify-center py-12"><div class="text-center"><i class="fas fa-spinner fa-spin text-slate-400 text-2xl mb-2"></i><p class="text-slate-500">Loading endpoints...</p></div></div>';
      
      try {
        const endpoints = await apiService.getEndpoints();
        renderEndpoints(endpoints);
      } catch (error) {
        grid.innerHTML = '<div class="flex items-center justify-center py-12"><div class="text-center text-red-500"><i class="fas fa-exclamation-triangle text-2xl mb-2"></i><p>Failed to load endpoints</p></div></div>';
      }
    }

    function renderEndpoints(endpoints) {
      const grid = document.getElementById('endpointsGrid');
      grid.innerHTML = '';
      
      if (endpoints.length === 0) {
        grid.innerHTML = `
          <div class="col-span-full text-center py-12">
            <i class="fas fa-inbox text-4xl text-slate-400 mb-4"></i>
            <h3 class="font-semibold text-slate-600 dark:text-slate-400">No endpoints yet</h3>
            <p class="text-slate-500 mt-2">Create your first API endpoint to get started</p>
            <button id="createFirstEndpoint" class="mt-4 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">
              <i class="fas fa-plus mr-2"></i>Create Endpoint
            </button>
          </div>
        `;
        document.getElementById('createFirstEndpoint').addEventListener('click', () => openEndpointModal());
        return;
      }
      
      endpoints.forEach(endpoint => {
        const template = document.getElementById('endpointTemplate').content.cloneNode(true);
        const card = template.querySelector('.endpoint-card');
        const methodBadge = template.querySelector('.method-badge');
        const title = template.querySelector('.endpoint-title');
        const desc = template.querySelector('.endpoint-desc');
        const url = template.querySelector('.endpoint-url');
        const statusIndicator = template.querySelector('.status-indicator');
        const testBtn = template.querySelector('.endpoint-test-btn');
        const editBtn = template.querySelector('.endpoint-edit-btn');
        const deleteBtn = template.querySelector('.endpoint-delete-btn');
        
        // Set endpoint data
        title.textContent = endpoint.name;
        desc.textContent = endpoint.description;
        url.textContent = endpoint.url;
        
        // Set method badge color
        methodBadge.textContent = endpoint.method;
        if (endpoint.method === 'GET') {
          methodBadge.className = 'px-2 py-1 rounded text-xs font-medium bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300';
        } else if (endpoint.method === 'POST') {
          methodBadge.className = 'px-2 py-1 rounded text-xs font-medium bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300';
        } else if (endpoint.method === 'PUT' || endpoint.method === 'PATCH') {
          methodBadge.className = 'px-2 py-1 rounded text-xs font-medium bg-indigo-100 dark:bg-indigo-900/30 text-indigo-800 dark:text-indigo-300';
        } else if (endpoint.method === 'DELETE') {
          methodBadge.className = 'px-2 py-1 rounded text-xs font-medium bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300';
        }
        
        // Set status indicator
        if (endpoint.is_active) {
          statusIndicator.className = 'status-indicator status-active';
        } else {
          statusIndicator.className = 'status-indicator status-inactive';
          card.classList.add('opacity-70');
        }
        
        // Add event listeners
        testBtn.addEventListener('click', () => {
          showPane('api-playground');
          document.getElementById('apiUrl').value = endpoint.url;
          document.getElementById('httpMethod').value = endpoint.method;
        });
        
        editBtn.addEventListener('click', () => {
          openEndpointModal(endpoint);
        });
        
        deleteBtn.addEventListener('click', async () => {
          if (confirm(`Are you sure you want to delete "${endpoint.name}"?`)) {
            try {
              await apiService.deleteEndpoint(endpoint.id);
              showNotification('Endpoint deleted successfully', 'success');
              loadEndpoints();
              loadDashboardStats(); // Refresh stats
            } catch (error) {
              showNotification('Failed to delete endpoint', 'error');
            }
          }
        });
        
        grid.appendChild(template);
      });
    }

    // Endpoint Modal
    const endpointModal = document.getElementById('endpointModal');
    const endpointForm = document.getElementById('endpointForm');
    const cancelModal = document.getElementById('cancelModal');

    function openEndpointModal(endpoint = null) {
      const modalTitle = document.getElementById('modalTitle');
      const endpointId = document.getElementById('endpointId');
      const endpointName = document.getElementById('endpointName');
      const endpointMethod = document.getElementById('endpointMethod');
      const endpointUrl = document.getElementById('endpointUrl');
      const endpointDescription = document.getElementById('endpointDescription');
      
      if (endpoint) {
        modalTitle.textContent = 'Edit Endpoint';
        endpointId.value = endpoint.id;
        endpointName.value = endpoint.name;
        endpointMethod.value = endpoint.method;
        endpointUrl.value = endpoint.url;
        endpointDescription.value = endpoint.description;
      } else {
        modalTitle.textContent = 'Create New Endpoint';
        endpointForm.reset();
        endpointId.value = '';
      }
      
      endpointModal.classList.remove('hidden');
      endpointModal.classList.add('flex');
    }

    endpointForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const endpointId = document.getElementById('endpointId').value;
      const formData = {
        name: document.getElementById('endpointName').value,
        method: document.getElementById('endpointMethod').value,
        url: document.getElementById('endpointUrl').value,
        description: document.getElementById('endpointDescription').value
      };
      
      try {
        if (endpointId) {
          await apiService.updateEndpoint(endpointId, formData);
          showNotification('Endpoint updated successfully', 'success');
        } else {
          await apiService.createEndpoint(formData);
          showNotification('Endpoint created successfully', 'success');
        }
        
        endpointModal.classList.add('hidden');
        endpointModal.classList.remove('flex');
        loadEndpoints();
        loadDashboardStats(); // Refresh stats
      } catch (error) {
        showNotification('Failed to save endpoint', 'error');
      }
    });

    cancelModal.addEventListener('click', () => {
      endpointModal.classList.add('hidden');
      endpointModal.classList.remove('flex');
    });

    // Quick Actions
    document.getElementById('quickAddEndpoint').addEventListener('click', () => openEndpointModal());
    document.getElementById('quickTestAll').addEventListener('click', async () => {
      try {
        showNotification('Testing all endpoints...', 'info');
        const results = await apiService.testAllEndpoints();
        showNotification(`Test completed: ${results.results.length} endpoints tested`, 'success');
        loadDashboardStats(); // Refresh stats
      } catch (error) {
        showNotification('Failed to test endpoints', 'error');
      }
    });

    document.getElementById('quickGenerateDocs').addEventListener('click', async () => {
      try {
        const docs = await apiService.generateDocs();
        showNotification('Documentation generated successfully', 'success');
        // In a real app, you might download the docs or show them in a modal
      } catch (error) {
        showNotification('Failed to generate documentation', 'error');
      }
    });

    document.getElementById('quickExportConfig').addEventListener('click', async () => {
      try {
        const config = await apiService.exportConfig();
        // Create a download link for the config
        const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `stellarbay-config-${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        showNotification('Configuration exported successfully', 'success');
      } catch (error) {
        showNotification('Failed to export configuration', 'error');
      }
    });

    // API Playground
    document.getElementById('sendReq').addEventListener('click', async () => {
      const method = document.getElementById('httpMethod').value;
      const url = document.getElementById('apiUrl').value.trim();
      
      if(!url){ 
        showNotification('Please enter a URL', 'error');
        return; 
      }

      let headers = {};
      try {
        headers = JSON.parse(document.getElementById('apiHeaders').value || '{}');
      } catch(e) {
        showNotification('Headers JSON is invalid', 'error');
        return;
      }

      let body = undefined;
      const bodyText = document.getElementById('apiBody').value.trim();
      if(bodyText && method !== 'GET') {
        try {
          body = JSON.parse(bodyText);
        } catch(e) {
          body = bodyText;
        }
      }

      // Show loading state
      const sendBtn = document.getElementById('sendReq');
      const originalText = sendBtn.innerHTML;
      sendBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Sending';
      sendBtn.disabled = true;

      try {
        const response = await apiService.testEndpoint({
          method,
          url,
          headers,
          body
        });

        document.getElementById('respStatus').textContent = response.status_code;
        
        let responseContent = response.data;
        if (typeof response.data === 'object') {
          responseContent = JSON.stringify(response.data, null, 2);
        }

        document.getElementById('respContent').textContent = responseContent;
        
        // Update sent count
        const sentCountEl = document.getElementById('sentCount');
        sentCountEl.textContent = parseInt(sentCountEl.textContent) + 1;
        
        // Highlight JSON if applicable
        if (typeof response.data === 'object') {
          document.getElementById('respContent').innerHTML = `<pre class="language-json"><code class="language-json">${JSON.stringify(response.data, null, 2)}</code></pre>`;
          Prism.highlightElement(document.getElementById('respContent').querySelector('code'));
        }

        showNotification('Request completed successfully', 'success');
      } catch(error) {
        document.getElementById('respStatus').textContent = 'Error';
        document.getElementById('respContent').textContent = error.message;
        showNotification('Request failed', 'error');
      } finally {
        sendBtn.innerHTML = originalText;
        sendBtn.disabled = false;
      }
    });

    document.getElementById('clearResp').addEventListener('click', ()=>{
      document.getElementById('respContent').textContent = 'No request yet — try sending one.';
      document.getElementById('respStatus').textContent = '—';
    });

    document.getElementById('copyResp').addEventListener('click', async ()=>{
      try {
        await navigator.clipboard.writeText(document.getElementById('respContent').textContent || '');
        showNotification('Response copied to clipboard', 'success');
      } catch(e){ 
        showNotification('Copy failed', 'error');
      }
    });

    document.getElementById('saveCurl').addEventListener('click', ()=>{
      const method = document.getElementById('httpMethod').value;
      const url = document.getElementById('apiUrl').value.trim();
      let headers = '{}';
      try { headers = document.getElementById('apiHeaders').value || '{}'; } catch{}
      let body = document.getElementById('apiBody').value.trim();

      let curl = `curl -X ${method} "${url}"`;
      try {
        const h = JSON.parse(headers || '{}');
        for(const k in h) {
          curl += ` -H "${k}: ${h[k]}"`;
        }
      } catch(e){}
      if(body) curl += ` -d '${body}'`;
      
      navigator.clipboard.writeText(curl).then(
        () => showNotification('cURL command copied', 'success'), 
        () => showNotification('Could not copy cURL', 'error')
      );
    });

    // Documentation
    async function loadDocumentation() {
      try {
        const endpoints = await apiService.getEndpoints();
        const endpointsList = document.getElementById('apiEndpointsList');
        endpointsList.innerHTML = '';
        
        endpoints.forEach(endpoint => {
          const row = document.createElement('div');
          row.className = 'grid grid-cols-12 gap-2 text-sm';
          
          let methodBadge = '';
          if (endpoint.method === 'GET') {
            methodBadge = '<span class="px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 rounded text-xs">GET</span>';
          } else if (endpoint.method === 'POST') {
            methodBadge = '<span class="px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300 rounded text-xs">POST</span>';
          } else if (endpoint.method === 'PUT' || endpoint.method === 'PATCH') {
            methodBadge = '<span class="px-2 py-1 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-800 dark:text-indigo-300 rounded text-xs">PUT</span>';
          } else if (endpoint.method === 'DELETE') {
            methodBadge = '<span class="px-2 py-1 bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300 rounded text-xs">DELETE</span>';
          }
          
          row.innerHTML = `
            <div class="col-span-2">${methodBadge}</div>
            <div class="col-span-6 font-mono text-xs">${endpoint.url}</div>
            <div class="col-span-4">${endpoint.description}</div>
          `;
          endpointsList.appendChild(row);
        });
      } catch (error) {
        console.error('Failed to load documentation:', error);
      }
    }

    // Global event listeners
    document.getElementById('newEndpointBtn').addEventListener('click', () => openEndpointModal());
    document.getElementById('refreshEndpoints').addEventListener('click', () => loadEndpoints());

    // Filter endpoints by status
    document.getElementById('statusFilter').addEventListener('change', (e) => {
      const status = e.target.value;
      document.querySelectorAll('.endpoint-card').forEach(card => {
        const isActive = card.querySelector('.status-indicator').classList.contains('status-active');
        if (status === 'all' || 
            (status === 'active' && isActive) || 
            (status === 'inactive' && !isActive)) {
          card.style.display = 'flex';
        } else {
          card.style.display = 'none';
        }
      });
    });

    // Global search
    document.getElementById('globalSearch').addEventListener('input', e => {
      const q = e.target.value.toLowerCase();
      if(!q) { 
        document.querySelectorAll('.endpoint-card').forEach(c => c.style.display='flex'); 
        return; 
      }
      
      document.querySelectorAll('.endpoint-card').forEach(card => {
        const text = (card.textContent || '').toLowerCase();
        card.style.display = text.includes(q) ? 'flex' : 'none';
      });
    });

    // Keyboard shortcuts
    window.addEventListener('keydown', (e)=>{
      // Cmd/Ctrl+K to focus search
      if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'k') {
        e.preventDefault();
        document.getElementById('globalSearch').focus();
      }
      
      // Escape to close sidebar on mobile and modals
      if(e.key === 'Escape') {
        if (window.innerWidth < 1024) {
          sidebar.classList.add('-translate-x-full');
        }
        endpointModal.classList.add('hidden');
        endpointModal.classList.remove('flex');
      }
    });

    // Notification system
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 anim-slide-in ${
        type === 'success' ? 'bg-green-500 text-white' :
        type === 'error' ? 'bg-red-500 text-white' :
        'bg-blue-500 text-white'
      }`;
      notification.innerHTML = `
        <div class="flex items-center">
          <i class="fas ${
            type === 'success' ? 'fa-check-circle' :
            type === 'error' ? 'fa-exclamation-circle' :
            'fa-info-circle'
          } mr-2"></i>
          <span>${message}</span>
        </div>
      `;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.classList.add('opacity-0', 'transition-opacity', 'duration-300');
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 300);
      }, 3000);
    }

    // Initialize the application
    async function initApp() {
      // Check authentication
      if (!authToken) {
        // Redirect to login or show login modal
        showNotification('Please log in to access the API platform', 'error');
        return;
      }

      // Load initial data
      await loadDashboardStats();
      await loadEndpoints();
      Prism.highlightAll();
      
      showNotification('StellarBay API Platform loaded successfully', 'success');
    }

    // Start the app when DOM is loaded
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>
</html>